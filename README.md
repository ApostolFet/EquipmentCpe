# EquipmentCpe

`EquipmentCpe` — это сервис активации оборудования по асинхронному API с поддержкой очередей и параллельной обработки задач. 
Проект реализован на Python 3.12 с использованием FastAPI, Celery, RabbitMQ и контейнеризация через Docker.

## Стек технологий
- Python 3.12
- FastAPI
- Celery
- RabbitMQ
- Docker / Docker Compose
- Pydantic
- Uvicorn
- Mypy (strict)
- Ruff
- uv

## Архитектура

Проект включает два сервиса:
1) Service A
    Синхронная заглушка для внешнего сервиса, недоступного для изменения
    POST /api/v1/equipment/cpe/{id}
    Принимает параметры конфигурации устройства
    Эмулирует работу внешнего API и возвращает ответ с задержкой до 60 секунд
    Поддерживает возврат кодов: 200, 404, 500

2) Service B
    Основной сервис, который:
        Получает запросы на активацию оборудования
        Ставит задачу в очередь
        Возвращает task_id клиенту
        Позволяет получить статус задачи

## Запуск проекта
1. Клонирование
```sh
git clone https://github.com/your-username/EquipmentCpe.git
cd EquipmentCpe
```
2. Копирование настроек 

```sh
cp .env.example .env
```

3. Запуск с помощью Docker Compose

```sh
docker-compose up --build
```

## Внутреннее устройство
    FastAPI реализует оба HTTP-интерфейса: приём задачи и статус задачи.
    Celery обрабатывает задачи асинхронно, используя RabbitMQ в качестве брокера.
    Надёжная обработка: повторные попытки (retry) при ошибок сервиса

## Разработка
При разработке предполагается использовать `uv`, но также возможно исппользовать и `pip` 

### Установка зависимостей для разработки
Установку выполняем с активированным виртуальноым окружением
#### Установка через uv
1. Установка пакета в editable режиме
```sh
uv pip install -e .
```
2. Устанавливаем группу `dev`
```sh
uv sync --group dev
```

#### Установка через pip
0. Обновляем pip (чтобы там была поддержка `dependency-groups`)
```sh
pip install --upgrade pip
```

1. Установка пакета в editable режиме
```sh
pip install -e .
```

2. Устанавливаем группу `dev`
```sh
pip install --group dev
```


### Проверка типов 
```sh
mypy
```

### Линтер

```sh
ruff check
```

### Форматер
```sh
ruff format
```
